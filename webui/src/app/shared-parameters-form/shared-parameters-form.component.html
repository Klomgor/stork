<!--    flex flex-column gap-4 -->
<div *ngIf="parameterNames.length > 0; else noRowsBlock" class="d-root-container">
    <ng-container *ngFor="let parameterName of parameterNames">
        <ng-container
            [ngTemplateOutlet]="parameterRowFlex"
            [ngTemplateOutletContext]="{
                parameterName: parameterName,
                controls: getParameterFormControls(parameterName)
            }"
        ></ng-container>
        <ng-template
            [formGroup]="formGroup"
            #parameterRowFlex
            let-parameterName="parameterName"
            let-controls="controls"
        >
            <!--             flex flex-column sm:flex-row gap-4 border-bottom-1 surface-border pb-4 -->
            <div class="d-row-param" [formGroupName]="parameterName">
                <!--   flex sm:block sm:w-3 gap-2              -->
                <div class="d-param-badge">
                    <!--  flex-auto             -->
                    <div class="font-semibold text-color-secondary">
                        {{ uncamelCase(parameterName) }}
                    </div>
                    <div class="sm:hidden">
                        <p-checkbox formControlName="unlocked" [binary]="true"> </p-checkbox>
                    </div>
                </div>
                <!-- flex gap-2 flex-auto               -->
                <div class="d-param-form">
                    <!--  flex gap-3 flex-column flex-auto                   -->
                    <div class="d-column-of-controls" formArrayName="values">
                        <ng-container *ngFor="let control of controls.get('values').controls; let index = index">
                            <ng-container
                                *ngIf="index === 0 || (controls.get('unlocked').value && index < servers.length)"
                            >
                                <!--  flex gap-2 w-full                           -->
                                <div class="d-row-control">
                                    <!--  flex flex-column-reverse sm:flex-row gap-2 flex-auto    -->
                                    <div class="d-form-and-server-tag">
                                        <div class="d-form-and-feedback">
                                            <div [ngSwitch]="controls.data?.type" class="d-form">
                                                <ng-container *ngSwitchCase="'string'">
                                                    <p-dropdown
                                                        *ngIf="controls.data?.values?.length > 0; else noValuesCase"
                                                        [autoDisplayFirst]="false"
                                                        [options]="controls.data.values"
                                                        [showClear]="true"
                                                        [formControlName]="index"
                                                        styleClass="w-full"
                                                        placeholder="(not specified)"
                                                    >
                                                    </p-dropdown>
                                                    <ng-template #noValuesCase>
                                                        <app-array-value-set-form
                                                            *ngIf="controls.data?.isArray; else noArrayCase"
                                                            [classFormControl]="control"
                                                        >
                                                        </app-array-value-set-form>
                                                        <ng-template #noArrayCase>
                                                            <input
                                                                pInputText
                                                                [formControlName]="index"
                                                                class="w-full"
                                                            />
                                                        </ng-template>
                                                    </ng-template>
                                                </ng-container>
                                                <ng-container *ngSwitchCase="'boolean'">
                                                    <p-triStateCheckbox ngDefaultControl [formControlName]="index">
                                                    </p-triStateCheckbox>
                                                </ng-container>
                                                <ng-container *ngSwitchCase="'number'">
                                                    <p-inputNumber
                                                        ngDefaultControl
                                                        [min]="controls.data.min"
                                                        [max]="controls.data.max"
                                                        [minFractionDigits]="0"
                                                        [maxFractionDigits]="controls.data.fractionDigits"
                                                        styleClass="w-full"
                                                        locale="en-US"
                                                        [formControlName]="index"
                                                    >
                                                        <!--                                inputStyleClass="w-full" -->
                                                    </p-inputNumber>
                                                </ng-container>
                                                <ng-container *ngSwitchCase="'client-classes'">
                                                    <app-dhcp-client-class-set-form
                                                        [classFormControl]="control"
                                                        [clientClasses]="clientClasses"
                                                        [floatingPlaceholder]="false"
                                                    >
                                                    </app-dhcp-client-class-set-form>
                                                </ng-container>
                                                <ng-container *ngSwitchDefault> Something else </ng-container>
                                            </div>
                                        </div>

                                        <span
                                            *ngIf="controls.get('unlocked').value && servers.length > index"
                                            class="d-server-tag"
                                        >
                                            <p-tag [severity]="getServerTagSeverity(index)">
                                                {{ servers[index] }}
                                            </p-tag>
                                        </span>
                                    </div>
                                    <button
                                        pRipple
                                        pButton
                                        [disabled]="control.value === null"
                                        label="Clear"
                                        class="d-btn p-button-text p-button-sm"
                                        type="button"
                                        (click)="control.setValue(null)"
                                    ></button>
                                </div>
                                <small
                                    *ngIf="control.invalid && (control.dirty || control.touched)"
                                    class="d-row-feedback p-error block"
                                    >{{ controls.data.invalidText }}
                                </small>
                            </ng-container>
                        </ng-container>
                    </div>
                    <div class="hidden sm:block">
                        <p-checkbox formControlName="unlocked" [binary]="true"> </p-checkbox>
                    </div>
                </div>
            </div>
        </ng-template>
    </ng-container>
</div>

<p-table
    *ngIf="parameterNames.length > 0; else noRowsBlock"
    [value]="parameterNames"
    styleClass="shared-parameters-table"
>
    <ng-template pTemplate="header">
        <tr>
            <th>Parameter</th>
            <th>Value</th>
            <th>Unlock</th>
        </tr>
    </ng-template>

    <ng-template pTemplate="body" let-parameterName let-rowgroup="rowgroup">
        <ng-container
            [ngTemplateOutlet]="parameterRow"
            [ngTemplateOutletContext]="{
                parameterName: parameterName,
                controls: getParameterFormControls(parameterName)
            }"
        >
        </ng-container>
    </ng-template>
</p-table>
<ng-template [formGroup]="formGroup" #parameterRow let-parameterName="parameterName" let-controls="controls">
    <!--    class="text-primary-500" -->
    <tr [formGroupName]="parameterName">
        <td class="font-semibold text-color-secondary">
            {{ uncamelCase(parameterName) }}
        </td>
        <td formArrayName="values">
            <ng-container *ngFor="let control of controls.get('values').controls; let index = index">
                <div
                    *ngIf="index === 0 || (controls.get('unlocked').value && index < servers.length)"
                    class="flex align-items-center pb-2 gap-2"
                >
                    <ng-container [ngSwitch]="controls.data?.type">
                        <ng-container *ngSwitchCase="'string'">
                            <p-dropdown
                                *ngIf="controls.data?.values?.length > 0; else noValuesCase"
                                [autoDisplayFirst]="false"
                                [options]="controls.data.values"
                                [showClear]="true"
                                [formControlName]="index"
                                styleClass="w-full"
                                placeholder="(not specified)"
                            >
                            </p-dropdown>
                            <ng-template #noValuesCase>
                                <app-array-value-set-form
                                    *ngIf="controls.data?.isArray; else noArrayCase"
                                    [classFormControl]="control"
                                >
                                </app-array-value-set-form>
                                <ng-template #noArrayCase>
                                    <input pInputText [formControlName]="index" class="" />
                                </ng-template>
                            </ng-template>
                        </ng-container>
                        <ng-container *ngSwitchCase="'boolean'">
                            <p-triStateCheckbox ngDefaultControl [formControlName]="index"> </p-triStateCheckbox>
                        </ng-container>
                        <ng-container *ngSwitchCase="'number'">
                            <p-inputNumber
                                ngDefaultControl
                                [min]="controls.data.min"
                                [max]="controls.data.max"
                                [minFractionDigits]="0"
                                [maxFractionDigits]="controls.data.fractionDigits"
                                styleClass="w-full"
                                locale="en-US"
                                [formControlName]="index"
                            >
                                <!--                                inputStyleClass="w-full" -->
                            </p-inputNumber>
                        </ng-container>
                        <ng-container *ngSwitchCase="'client-classes'">
                            <app-dhcp-client-class-set-form
                                [classFormControl]="control"
                                [clientClasses]="clientClasses"
                                [floatingPlaceholder]="false"
                                styleClass="w-1"
                            >
                            </app-dhcp-client-class-set-form>
                        </ng-container>
                        <ng-container *ngSwitchDefault> Something else </ng-container>
                    </ng-container>
                    <span *ngIf="controls.get('unlocked').value && servers.length > index" class="pl-2">
                        <p-tag [severity]="getServerTagSeverity(index)">
                            {{ servers[index] }}
                        </p-tag>
                    </span>
                    <button
                        pRipple
                        pButton
                        [disabled]="control.value === null"
                        label="Clear"
                        class="p-button-text p-button-sm"
                        type="button"
                        (click)="control.setValue(null)"
                    ></button>
                </div>
                <small *ngIf="control.invalid && (control.dirty || control.touched)" class="p-error block pb-3"
                    >{{ controls.data.invalidText }}
                </small>
            </ng-container>
        </td>
        <td>
            <p-checkbox formControlName="unlocked" [binary]="true"> </p-checkbox>
        </td>
    </tr>
</ng-template>
<ng-template #noRowsBlock>
    <span>No parameters configured.</span>
</ng-template>
