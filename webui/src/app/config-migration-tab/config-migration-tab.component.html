<div *ngIf="migration" class="mt-4 mx-2 max-w-50rem">
    <div class="flex text-xl align-items-baseline font-normal text-primary mb-4">
        <div class="fa fa-suitcase mr-2"></div>
        <div id="tab-title-span">Migration: {{ migration.id }}</div>
    </div>

    <div class="flex flex-wrap gap-4">
        <!-- Status Info -->
        <div class="flex-auto md:w-6">
            <p-fieldset legend="Status" class="mb-4">
                <div class="flex flex-column gap-3">
                    <div class="flex align-items-center">
                        <span class="font-semibold w-8rem">Status:</span>
                        <p-tag [severity]="statusSeverity" [value]="statusText"></p-tag>
                        <span *ngIf="isFailed && migration.generalError" class="ml-3 text-red-500">
                            {{ migration.generalError }}
                        </span>
                    </div>

                    <div class="flex align-items-center">
                        <span class="font-semibold w-8rem">Progress:</span>
                        <p-progressBar [value]="completionPercentage" [showValue]="true" class="flex-1"></p-progressBar>
                    </div>

                    <div class="flex align-items-center">
                        <span class="font-semibold w-8rem">Start Date:</span>
                        <span>{{ migration.startDate | date: 'medium' }}</span>
                    </div>

                    <div class="flex align-items-center" *ngIf="migration.endDate">
                        <span class="font-semibold w-8rem">End Date:</span>
                        <span>{{ migration.endDate | date: 'medium' }}</span>
                    </div>

                    <div class="flex align-items-center">
                        <span class="font-semibold w-8rem">Duration:</span>
                        <span>{{ migration.elapsedTime }}</span>
                    </div>

                    <div class="flex align-items-center" *ngIf="isRunning">
                        <span class="font-semibold w-8rem">Estimated Left:</span>
                        <span>{{ migration.estimatedLeftTime }}</span>
                    </div>

                    <div class="flex align-items-center" *ngIf="totalErrors > 0">
                        <span class="font-semibold w-8rem">Errors:</span>
                        <p-tag severity="danger" [value]="totalErrors + ' errors'"></p-tag>
                    </div>
                </div>
            </p-fieldset>
        </div>
    </div>

    <!-- Errors Section - Always visible if there are errors -->
    <div *ngIf="totalErrors > 0" class="mt-4">
        <p-fieldset legend="Errors">
            <p-table [value]="errorItems" styleClass="p-datatable-sm">
                <ng-template pTemplate="header">
                    <tr>
                        <th style="width: 15%">Entity Type</th>
                        <th style="width: 15%">ID</th>
                        <th style="width: 15%">Label</th>
                        <th style="width: 55%">Error</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-error>
                    <tr>
                        <td>{{ error.type }}</td>
                        <td>{{ error.hostId }}</td>
                        <td>{{ error.label }}</td>
                        <td class="text-red-500">{{ error.error }}</td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td colspan="4">No error details available</td>
                    </tr>
                </ng-template>
            </p-table>
        </p-fieldset>
    </div>

    <!-- Actions Section -->
    <div class="mt-4">
        <button
            type="button"
            pButton
            label="Refresh"
            icon="pi pi-refresh"
            class="mr-2"
            (click)="refreshMigration()"
        ></button>

        <button
            type="button"
            pButton
            label="Cancel Migration"
            icon="pi pi-times"
            class="p-button-danger"
            [disabled]="!isRunning || migration.canceling"
            (click)="cancelMigration()"
        ></button>
    </div>
</div>
